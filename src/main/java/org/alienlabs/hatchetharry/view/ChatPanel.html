<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:wicket="http://wicket.apache.org/dtds.data/wicket-xhtml1.4-strict.dtd"
        xml:lang="en"
        lang="en">
<wicket:head>
    <script>

    jQuery(document).ready(function() {
            function callback(response) {
                // Websocket events.
                jQuery.atmosphere.log('info', ["response.state: " + response.state]);
                jQuery.atmosphere.log('info', ["response.transport: " + response.transport]);
                if (response.transport != 'polling' && response.state != 'connected' && response.state != 'closed') {
                	jQuery.atmosphere.log('info', ["response.responseBody: " + response.responseBody]);
                    if (response.status == 200) {
                        var data = response.responseBody;
                        if (typeof(data.split("###")[1]) != "undefined") { // We're in the chat Meteor
                        	document.getElementById('chat').innerHTML =
                        		document.getElementById('chat').innerHTML + "\n" + data.split("###")[1];
                        }
                    }
                }
            }

            // You can set websocket, streaming or long-polling here.
            jQuery.atmosphere.subscribe(document.getElementById('chatStart').href,
            		callback,
                    jQuery.atmosphere.request = {transport: 'streaming'});
        });
    </script>
</wicket:head>
<body>
<wicket:panel>
    <a wicket:id="chatStart" id="chatStart"></a>
	<form wicket:id="chatForm" action="">
		<textarea id="chat" cols="60" rows="20" readonly="readonly"></textarea><br/><br/>
		Your name: <input wicket:id="user" type="text"></input><br/>
		Message: <input wicket:id="message" type="text"></input><br/>
		<input wicket:id="submit" type="submit"></input>
	</form>
    <div>
	<iframe id="comet-frame" style="display: none;"></iframe>
    </div>
</wicket:panel>
</body>
</html>